<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LJK Digital CPNS - Mode Fokus</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f4f6f8; padding: 20px; max-width: 600px; margin: 0 auto; color: #333; }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px; }
        
        .section-header { background: #34495e; color: #fff; padding: 10px 15px; border-radius: 6px; margin-top: 30px; font-weight: bold; letter-spacing: 0.5px; }
        
        .question-row { display: flex; align-items: center; background: #fff; margin-bottom: 8px; padding: 12px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .q-num { width: 40px; font-weight: bold; color: #555; }
        .options { display: flex; gap: 8px; flex-grow: 1; justify-content: space-around; }
        
        /* Radio Button Desain Tombol */
        input[type="radio"] { display: none; }
        label { 
            display: inline-block; width: 40px; height: 40px; line-height: 40px; 
            text-align: center; border-radius: 50%; background: #eee; color: #555;
            cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s;
        }
        input[type="radio"]:checked + label { background: #2980b9; color: white; transform: scale(1.1); box-shadow: 0 2px 5px rgba(41, 128, 185, 0.4); }
        
        /* Warna Koreksi */
        .correct { background-color: #d4edda !important; border-left: 5px solid #28a745; }
        .wrong { background-color: #fff3cd !important; border-left: 5px solid #ffc107; } /* Kuning buat TKP beda opsi */
        .wrong-tiu { background-color: #f8d7da !important; border-left: 5px solid #dc3545; } /* Merah buat TIU/TWK salah */

        /* Area Rahasia */
        #secret-area { display: none; margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .score-card { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .score-box { background: white; padding: 15px; text-align: center; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .score-box small { display: block; color: #888; font-size: 0.8em; margin-bottom: 5px; }
        .score-box strong { font-size: 1.5em; color: #2c3e50; }
        
        textarea { width: 100%; height: 80px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; letter-spacing: 2px; }
        
        .btn-main { display: block; width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-check { background: #2980b9; margin-top: 10px; }
        
        .sticky-footer { position: sticky; bottom: 20px; z-index: 100; }
    </style>
</head>
<body>

    <h2>LJK Digital CPNS</h2>
    <div class="subtitle">Fokus kerjakan dulu. Kunci jawaban diinput di akhir.</div>

    <form id="ljkForm">
        <div class="section-header">TWK (1-30) - Nasinalisme & Pilar Negara</div>
        <div id="twk-container"></div>

        <div class="section-header">TIU (31-65) - Logika & Hitungan</div>
        <div id="tiu-container"></div>

        <div class="section-header">TKP (66-110) - Karakteristik Pribadi</div>
        <div id="tkp-container"></div>
    </form>

    <div class="sticky-footer">
        <button type="button" class="btn-main" onclick="bukaAreaKunci()">Selesai Mengerjakan (Buka Kunci)</button>
    </div>

    <div id="secret-area">
        <h3>Input Kunci Jawaban</h3>
        <p style="font-size:0.9em; color:#666;">Salin kunci jawaban dari buku (misal: BACCD...) tanpa spasi.</p>
        <textarea id="answerKey" placeholder="Paste kunci jawaban di sini..."></textarea>
        
        <button type="button" class="btn-main btn-check" id="btn-hitung" onclick="calculateScore()">HITUNG SKOR</button>

        <div id="result-display" style="display:none; margin-top:20px;">
            <div class="score-card">
                <div class="score-box">
                    <small>TWK</small>
                    <strong id="score-twk">0</strong>
                </div>
                <div class="score-box">
                    <small>TIU</small>
                    <strong id="score-tiu">0</strong>
                </div>
                <div class="score-box">
                    <small>TKP (Est)</small>
                    <strong id="score-tkp">0</strong>
                </div>
            </div>
            <div style="text-align:center; background:#2c3e50; color:white; padding:15px; border-radius:8px;">
                TOTAL SKD: <span id="total-score" style="font-size:1.5em; font-weight:bold;">0</span>
            </div>
            <p style="font-size:0.8em; text-align:center; color:#888; margin-top:10px;">
                *Catatan TKP: Poin dihitung 5 jika sama persis dengan kunci. Jika beda, cek manual di buku (nilai 1-4).
            </p>
            <button type="button" style="background:#c0392b; color:white; border:none; padding:10px; border-radius:5px; margin-top:20px; width:100%;" onclick="resetForm()">Reset Semua</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        // Kalau mau pake Google Sheet, paste URL Apps Script di sini
        const scriptURL = ''; 
        
        // 1. Generate Soal
        function createQuestions(start, end, containerId) {
            const container = document.getElementById(containerId);
            for (let i = start; i <= end; i++) {
                let html = `<div class="question-row" id="row-${i}">
                    <div class="q-num">${i}.</div>
                    <div class="options">`;
                ['A', 'B', 'C', 'D', 'E'].forEach(opt => {
                    html += `<input type="radio" name="q${i}" id="q${i}${opt}" value="${opt}" onchange="saveAnswer(${i}, '${opt}')">
                             <label for="q${i}${opt}">${opt}</label>`;
                });
                html += `</div></div>`;
                container.innerHTML += html;
            }
        }

        createQuestions(1, 30, 'twk-container');
        createQuestions(31, 65, 'tiu-container');
        createQuestions(66, 110, 'tkp-container');

        // 2. Logic Buka Tutup
        function bukaAreaKunci() {
            document.querySelector('.sticky-footer').style.display = 'none'; // Sembunyikan tombol selesai
            document.getElementById('secret-area').style.display = 'block'; // Munculkan area kunci
            window.scrollTo(0, document.body.scrollHeight);
            alert("Silakan input kunci jawaban dari buku sekarang.");
        }

        // 3. LocalStorage (Simpan Otomatis)
        window.onload = function() {
            for (let i = 1; i <= 110; i++) {
                const saved = localStorage.getItem('cpns_q' + i);
                if (saved) {
                    const el = document.getElementById('q' + i + saved);
                    if (el) el.checked = true;
                }
            }
        };

        function saveAnswer(n, val) {
            localStorage.setItem('cpns_q' + n, val);
        }

        // 4. LOGIC SKORING YANG BEDA-BEDA
        function calculateScore() {
            const keyRaw = document.getElementById('answerKey').value.toUpperCase().replace(/[^A-E]/g, '');
            if (keyRaw.length < 110) {
                alert(`Kunci jawaban kurang! Baru ${keyRaw.length} dari 110.`);
                return;
            }

            let sTWK = 0, sTIU = 0, sTKP = 0;
            
            // Reset Style
            document.querySelectorAll('.question-row').forEach(r => r.className = 'question-row');

            for (let i = 1; i <= 110; i++) {
                const userAns = document.querySelector(`input[name="q${i}"]:checked`);
                const keyAns = keyRaw[i-1];
                const row = document.getElementById(`row-${i}`);
                
                if (userAns) {
                    const val = userAns.value;
                    
                    // --- LOGIKA SKORING ---
                    if (i <= 30) { 
                        // TWK: Benar=5, Salah=0
                        if (val === keyAns) { sTWK += 5; row.classList.add('correct'); }
                        else { row.classList.add('wrong-tiu'); }
                    } 
                    else if (i <= 65) { 
                        // TIU: Benar=5, Salah=0
                        if (val === keyAns) { sTIU += 5; row.classList.add('correct'); }
                        else { row.classList.add('wrong-tiu'); }
                    } 
                    else { 
                        // TKP: Sama=5, Beda= ? (Tandai kuning)
                        if (val === keyAns) { sTKP += 5; row.classList.add('correct'); }
                        else { row.classList.add('wrong'); } // Kuning, ingatkan user cek manual
                    }
                }
            }

            // Tampilkan
            document.getElementById('score-twk').innerText = sTWK;
            document.getElementById('score-tiu').innerText = sTIU;
            document.getElementById('score-tkp').innerText = sTKP;
            document.getElementById('total-score').innerText = sTWK + sTIU + sTKP;
            document.getElementById('result-display').style.display = 'block';
            
            // (Opsional: Kirim ke Google Sheet kalau sudah setup)
            if (scriptURL) sendToSheet(sTWK, sTIU, sTKP);
        }

        function resetForm() {
            if(confirm('Hapus semua jawaban dan mulai dari nol?')) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
